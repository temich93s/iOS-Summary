# Optional chaining (Опциональная цепочка)

- Опциональная цепочка (optional chaining) - процесс запросов и вызовов свойств, методов, сабскриптов (индексов) у опционала, который может быть nil.
- Вы можете использовать опциональную последовательность для вызовов свойств, методов, сабскриптов, которые находятся более чем на один уровень глубже. Это позволяет вам пробираться через подсвойства, внутри сложных моделей вложенных типов, и проверять возможность доступа свойств, методов и сабскриптов этих подсвойств.

## 1. Общие сведения

- При принудительном извлечении будет ошибка, а при опциональной последовательности нет, так как вернется nil

```Swift
class Person {
    var residence: Residence?
}
 
class Residence {
    var numberOfRooms = 1
}

let john = Person()

// ошибка runtime, поскольку residence = nil
let roomCount = john.residence!.numberOfRooms

// Опциональная последовательность
if let roomCount = john.residence?.numberOfRooms {
    print("John's residence has \(roomCount) room(s).")
} else {
    print("Unable to retrieve the number of rooms.")
}
// Выведет "Unable to retrieve the number of rooms."
```

## 2. Доступ к свойствам через опциональные цепочки

- Вы можете использовать опциональную последовательность для доступа к свойству опционального значения и проверить результат доступа к этому свойству на успешность.

```Swift
if let roomCount = john.residence?.numberOfRooms {
    print("")
} else {
    print("")
}
```

- Вы можете попробовать установить значение свойства через опциональную последовательность

```Swift
john.residence?.address = someAddress
```

## 3. Вызов методов через опциональные цепочки

- Вы можете использовать опциональную последовательность для вызова метода опциональной величины, и проверить сам вызов метода на успешность. 

```Swift
if john.residence?.printNumberOfRooms() != nil {
    print("")
} else {
    print("")
}
```

- Попытка установить свойство через опциональную последовательность 

```Swift
if (john.residence?.address = someAddress) != nil {
    print("")
} else {
    print("")
}
```

## 4. Доступ к сабскриптам через опциональные цепочки

- Когда вы получаете доступ к опциональному значению через опциональную последовательность, вы размещаете вопросительный знак до скобок сабскрипта (индекса), а не после. 
- Вопросительный знак опциональной последовательности следует сразу после части выражения, которая является опционалом. 
- Вы можете использовать опциональную последовательность для того, чтобы попробовать получить и установить значения из индекса опционального значения, и проверить успешность выполнения вызова сабскрипта.

```Swift
if let firstRoomName = john.residence?[0].name {
    print("")
} else {
    print("")
}
```

- вы можете попробовать установить новое значение через сабскрипт с помощью опциональной последовательности

```Swift
john.residence?[0] = Room(name: "Bathroom")
```

## 5. Получение доступа к сабскрипту (индексу) опционального типа

- Если сабскрипт возвращает значение опционального типа, например ключ словаря типа Dictionary в Swift, то мы должны поставить вопросительный знак после закрывающей скобки сабскрипта, для присоединения его опционального возвращаемого значения:

```Swift
var testScores = ["Dave": [86, 82, 84], "Bev": [79, 94, 81]]
testScores["Dave"]?[0] = 91
testScores["Bev"]?[0] += 1
testScores["Brian"]?[0] = 72
// массив "Dave" теперь имеет вид [91, 82, 84], массив "Bev" - [80, 94, 81]
```

## 6. Соединение нескольких уровней опционального типа

- Вы можете соединить несколько уровней опциональных последовательностей вместе для того, чтобы пробраться до свойств, методов, сабскриптов, которые находятся глубже в модели. Однако многоуровневые опциональные последовательности не добавляют новых уровней опциональности к возвращаемым значениям
  - Если тип, который вы пытаетесь получить не опциональный, то он станет опциональным из-за опциональной последовательности.
  - Если тип, который вы пытаетесь получить, уже опциональный, то более опциональным он уже не станет, даже по причине опциональной последовательности.

```Swift
if let johnsStreet = john.residence?.address?.street {
    print("")
} else {
    print("")
}
```

## 7. Связывание методов в опциональной цепочки с опциональными возвращаемыми значениями

- Вы так же можете использовать опциональную последовательность для вызова метода, который возвращает значение опционального типа, а затем к этой опциональной последовательности может прикрепить и возвращаемое значение самого метода, если это нужно.
- В примере выше вы разместили вопросительный знак опциональной привязки после круглых скобок метода, потому что опциональная величина, которую вы присоединяете к последовательности, является возвращаемой величиной метода buildingIdentifier, а не самим методом buildingIdentifier.

```Swift
if let beginsWithThe = john.residence?.address?.buildingIdentifier()?.hasPrefix("The") {
    if beginsWithThe {
        print("")
    } else {
        print("")
    }
}
```